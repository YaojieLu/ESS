
source("Normal plants/Functions.r")

# Parameters
pe <- -1.58*10^-3
c <- 2.64
d <- 3.54
# PLC(w)
PLCf <- function(x)(1-exp(-(-x/d)^c))*100

f <- function(x)PLCf(x)-50
P50 <- uniroot(f, c(-8, 0), tol=.Machine$double.eps)$root

# Initializing
ca <- 400
ESSf1 <- Vectorize(function(w)ESSf(w, ca))
ESSBf1 <- Vectorize(function(w)ESSBf(w, ca))
ESSPLCf1 <- Vectorize(function(w)ESSPLCf(w, ca))
ESSpsf1 <- Vectorize(function(ps)ESSpsf(ps, ca))
ESSBpsf1 <- Vectorize(function(ps)ESSBpsf(ps, ca))

wL <- uniroot(ESSBf1, c(0.12, 1), tol=.Machine$double.eps)$root
psL <- with(data.frame(pe=c(-1.58*10^-3), b=c(4.38)), pe*wL^(-b))

# Figures
windows(8, 18)
par(mgp=c(2.2, 1, 0), xaxs="i", yaxs="i", lwd=2, oma=c(0, 0, 0, 3.5), mar=c(4, 4, 1, 1), mfrow=c(3, 1))
# PLC(px)
curve(PLCf, -8, 0, xlim=c(-8, 0), ylim=c(0, 100),
      #main="Vulnerability curve for modelled plant",
      xlab=NA, ylab=NA, yaxt="n")

mtext("PLC (%)",side=2,line=2, cex=1.3)
axis(2, ylim=c(0, 100), pos=-8, lwd=2, at=c(0, 25, 50, 75, 100))
mtext(expression(psi[xylem]~(MPa)),side=1,line=2.8, cex=1.3)
abline(v=P50, lwd=0.5, lty=2)
abline(h=50, lwd=0.5, lty=2)
points(P50, 50, pch=16, cex=1.2)
text(-1.5, 57, as.expression(bquote(psi[50]==.(round(P50, digits=2))~MPa)), cex.lab=1.3)
text(-0.4, 93, "a", cex=1.5)

